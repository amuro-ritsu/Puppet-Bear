<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ğŸ» Puppet Bear v1.15.2</title>
    
    <!-- PWA ãƒ¡ã‚¿ã‚¿ã‚° -->
    <meta name="description" content="Puppet Bear - ãƒ‘ãƒšãƒƒãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç·¨é›†ãƒ„ãƒ¼ãƒ«">
    <meta name="theme-color" content="#3d2817">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Puppet Bear">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#3d2817">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- PWA ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
    
    <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- JSZipï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜ç”¨ï¼‰ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- ag-psdï¼ˆPSDãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç”¨ - ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œç‰ˆï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/ag-psd@28.4.1/dist/bundle.js"></script>
    
    <!-- iOS Safari ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
    <div class="app-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="header">
            <img src="logo.png" alt="Puppet Bear" class="header-logo">
            <div class="header-buttons">
                <button id="save-project-btn" class="btn-project" onclick="saveProject()">
                    ğŸ’¾ ä¿å­˜
                </button>
                <button id="load-project-btn" class="btn-project" onclick="loadProjectDialog()">
                    ğŸ“‚ èª­è¾¼
                </button>
                <button id="export-btn" class="btn-export" onclick="showExportDialog()">
                    ğŸ“¤ æ›¸ãå‡ºã—
                </button>
            </div>
        </header>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆ -->
            <aside class="sidebar sidebar-left">
                <div id="layer-list" class="layer-list"></div>
            </aside>
            
            <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
            <div class="center-panel">
                <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šéƒ¨ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                <div class="canvas-toolbar" id="canvas-toolbar">
                    <div class="toolbar-group">
                        <button id="header-tool-rotation" onclick="toggleTool('rotation')" class="toolbar-btn" title="å›è»¢ãƒãƒ³ãƒ‰ãƒ«">ğŸ” å›è»¢</button>
                        <button id="header-tool-position" onclick="toggleTool('position')" class="toolbar-btn" title="ãƒã‚¸ã‚·ãƒ§ãƒ³ç§»å‹•">ğŸ‘‡ ç§»å‹•</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <div class="toolbar-group">
                        <button id="header-anchor-pick" onclick="startAnchorPointPick()" class="toolbar-btn" title="ã‚¢ãƒ³ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã§è¨­å®š">ğŸ¯ ã‚¢ãƒ³ã‚«ãƒ¼è¨­å®š</button>
                        <button id="header-anchor-reset" onclick="resetAnchorPoint()" class="toolbar-btn toolbar-btn-small" title="ã‚¢ãƒ³ã‚«ãƒ¼ã‚’ä¸­å¤®ã«æˆ»ã™">â†©ï¸</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <label class="toolbar-checkbox">
                        <input type="checkbox" id="show-pins-checkbox" checked>
                        <span>ğŸ“ ãƒ”ãƒ³è¡¨ç¤º</span>
                    </label>
                    <div class="toolbar-separator"></div>
                    <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                    <div class="toolbar-group canvas-zoom-control">
                        <button onclick="zoomCanvas(-0.1)" class="toolbar-btn toolbar-btn-small" title="ç¸®å°">â–</button>
                        <input type="range" id="canvas-zoom-slider" class="zoom-slider" 
                               min="0.1" max="5" step="0.1" value="1"
                               oninput="setCanvasZoom(this.value)" title="ã‚ºãƒ¼ãƒ ">
                        <span id="canvas-zoom-value" class="canvas-zoom-value">100%</span>
                        <button onclick="zoomCanvas(0.1)" class="toolbar-btn toolbar-btn-small" title="æ‹¡å¤§">â•</button>
                        <button onclick="resetCanvasZoom()" class="toolbar-btn toolbar-btn-small" title="ãƒªã‚»ãƒƒãƒˆ">â†º</button>
                        <button onclick="fitCanvasToView()" class="toolbar-btn toolbar-btn-small" title="ç”»é¢ã«ãƒ•ã‚£ãƒƒãƒˆ">â¬œ</button>
                    </div>
                    <div class="toolbar-separator"></div>
                    <!-- ã‚¢ãƒ³ã‚«ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆå¤§ããé…ç½®ï¼‰ -->
                    <div class="toolbar-group" id="header-anchor-sliders" style="display: flex; gap: 12px; align-items: center;">
                        <label class="toolbar-slider-label" style="display: flex; align-items: center; gap: 4px; min-width: 140px;">
                            <span style="white-space: nowrap;">âš“X:<span id="headerAnchorX">50</span>%</span>
                            <input type="range" class="toolbar-slider" id="header-anchor-x-slider" value="50" min="0" max="100" step="1"
                                style="width: 100px; cursor: pointer;"
                                oninput="document.getElementById('headerAnchorX').textContent = this.value; setAnchorPointLive('x', parseFloat(this.value) / 100)">
                        </label>
                        <label class="toolbar-slider-label" style="display: flex; align-items: center; gap: 4px; min-width: 140px;">
                            <span style="white-space: nowrap;">âš“Y:<span id="headerAnchorY">50</span>%</span>
                            <input type="range" class="toolbar-slider" id="header-anchor-y-slider" value="50" min="0" max="100" step="1"
                                style="width: 100px; cursor: pointer;"
                                oninput="document.getElementById('headerAnchorY').textContent = this.value; setAnchorPointLive('y', parseFloat(this.value) / 100)">
                        </label>
                        <label class="toolbar-slider-label" style="display: flex; align-items: center; gap: 4px; min-width: 160px;" title="æºã‚Œã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®è»¸æ–¹å‘">
                            <span style="white-space: nowrap;">ğŸ”„è»¸:<span id="headerAnchorRot">0</span>Â°</span>
                            <input type="range" class="toolbar-slider" id="header-anchor-rot-slider" value="0" min="-180" max="180" step="1"
                                style="width: 100px; cursor: pointer;"
                                oninput="document.getElementById('headerAnchorRot').textContent = this.value; setAnchorRotation(parseFloat(this.value))">
                        </label>
                    </div>
                </div>
                
                <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
                <div class="canvas-area">
                    <!-- ãƒã‚¹ã‚¯ç·¨é›†ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                    <div id="mask-toolbar" class="mask-toolbar" style="display: none;"></div>
                    <div id="canvasContainer" class="canvas-container">
                        <canvas id="canvas"></canvas>
                    </div>
                </div>
                
                <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
                <div class="timeline-container">
                    <!-- ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ« -->
                    <div class="timeline-resize-handle" id="timeline-resize-handle"></div>
                    <div class="timeline-header">
                        <span class="timeline-title">ğŸ¬ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</span>
                        
                        <!-- å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                        <div class="playback-controls">
                            <button id="play-btn" class="playback-btn kuma-btn" title="å†ç”Ÿ/ä¸€æ™‚åœæ­¢">
                                <img src="play.png" alt="å†ç”Ÿ" class="kuma-icon" id="play-icon">
                            </button>
                            <button id="stop-btn" class="playback-btn kuma-btn" title="åœæ­¢">
                                <img src="stop.png" alt="åœæ­¢" class="kuma-icon">
                            </button>
                            <label class="loop-checkbox">
                                <input type="checkbox" id="loop-playback-checkbox" onchange="setLoopPlayback(this.checked)">
                                <span>ğŸ”</span>
                            </label>
                            <span id="current-frame-display" class="current-frame">00åˆ†00ç§’ (0f)</span>
                            <div class="fps-selector">
                                <button id="fps-24" class="fps-btn active">24</button>
                                <button id="fps-30" class="fps-btn">30</button>
                            </div>
                        </div>
                        
                        <!-- ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                        <div class="timeline-zoom-control">
                            <span class="zoom-label">ğŸ”</span>
                            <button class="zoom-btn" onclick="zoomTimeline(-1)" title="ç¸®å°">âˆ’</button>
                            <input type="range" id="timeline-zoom-slider" class="zoom-slider" 
                                min="5" max="60" value="20" step="1"
                                oninput="setTimelineZoom(parseInt(this.value))"
                                title="ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚ºãƒ¼ãƒ ">
                            <button class="zoom-btn" onclick="zoomTimeline(1)" title="æ‹¡å¤§">+</button>
                            <span id="zoom-value" class="zoom-value">100%</span>
                            <button class="zoom-btn zoom-reset" onclick="resetTimelineZoom()" title="ãƒªã‚»ãƒƒãƒˆ">â†º</button>
                        </div>
                        
                        <!-- Undo/Redo ãƒœã‚¿ãƒ³ -->
                        <div class="undo-redo-buttons">
                            <button id="undo-btn" class="icon-btn kuma-btn" onclick="undo()" title="å…ƒã«æˆ»ã™ (Ctrl+Z)" disabled>
                                <img src="undo.png" alt="å…ƒã«æˆ»ã™" class="kuma-icon-small">
                            </button>
                            <button id="redo-btn" class="icon-btn kuma-btn" onclick="redo()" title="ã‚„ã‚Šç›´ã— (Ctrl+Y)" disabled>
                                <img src="redo.png" alt="ã‚„ã‚Šç›´ã—" class="kuma-icon-small">
                            </button>
                        </div>
                    </div>
                    <div class="timeline-body">
                        <div class="timeline-rows-container">
                            <div id="timeline-layers" class="timeline-layers"></div>
                            <div id="timeline" class="timeline">
                                <div id="timeline-content" class="timeline-content"></div>
                                <div id="playhead" class="playhead"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ« -->
            <aside class="sidebar sidebar-right">
                <h2>âš™ï¸ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</h2>
                <div id="properties-panel" class="properties-panel">
                    <p>ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                </div>
            </aside>
        </div>
    </div>
    
    <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ï¼ˆé †ç•ªé‡è¦ï¼‰ -->
    <script src="app-core.js"></script>
    <script src="app-history.js"></script>
    <script src="app-windsway.js"></script>
    <script src="app-wiggle.js"></script>
    <script src="app-bounce.js"></script>
    <script src="app-walking.js"></script>
    <script src="app-puppet.js"></script>
    <script src="app-audio.js"></script>
    <script src="app-mask.js"></script>
    <script src="app-timeline.js"></script>
    <script src="app-animation.js"></script>
    <script src="app-layers.js"></script>
    <script src="app-tools.js"></script>
    <script src="app-clipping.js"></script>
    <script src="app-properties.js"></script>
    <script src="app-export.js"></script>
    <script src="app-project.js"></script>
    <script src="app-touch.js"></script>
    <script src="app.js"></script>
    
    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const handle = document.getElementById('timeline-resize-handle');
        const timelineContainer = document.querySelector('.timeline-container');
        
        console.log('ğŸšï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒªã‚µã‚¤ã‚ºåˆæœŸåŒ–', handle, timelineContainer);
        
        if (!handle || !timelineContainer) {
            console.error('ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã¾ãŸã¯ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
        }
        
        let isResizing = false;
        let startY = 0;
        let startHeight = 0;
        
        handle.addEventListener('mousedown', function(e) {
            isResizing = true;
            startY = e.clientY;
            startHeight = timelineContainer.offsetHeight;
            document.body.style.cursor = 'ns-resize';
            document.body.style.userSelect = 'none';
            console.log('ğŸšï¸ ãƒªã‚µã‚¤ã‚ºé–‹å§‹', startHeight);
            e.preventDefault();
            e.stopPropagation();
        });
        
        document.addEventListener('mousemove', function(e) {
            if (!isResizing) return;
            const delta = startY - e.clientY;
            const newHeight = Math.max(150, Math.min(window.innerHeight * 0.7, startHeight + delta));
            timelineContainer.style.height = newHeight + 'px';
            // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’å†æç”»
            if (typeof updateTimeline === 'function') {
                updateTimeline();
            }
        });
        
        document.addEventListener('mouseup', function() {
            if (isResizing) {
                isResizing = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
                console.log('ğŸšï¸ ãƒªã‚µã‚¤ã‚ºçµ‚äº†', timelineContainer.offsetHeight);
                // æœ€çµ‚çš„ãªå†æç”»
                if (typeof updateTimeline === 'function') {
                    updateTimeline();
                }
            }
        });
        
        // ã‚¿ãƒƒãƒå¯¾å¿œ
        handle.addEventListener('touchstart', function(e) {
            isResizing = true;
            startY = e.touches[0].clientY;
            startHeight = timelineContainer.offsetHeight;
            e.preventDefault();
        }, { passive: false });
        
        document.addEventListener('touchmove', function(e) {
            if (!isResizing) return;
            const delta = startY - e.touches[0].clientY;
            const newHeight = Math.max(150, Math.min(window.innerHeight * 0.7, startHeight + delta));
            timelineContainer.style.height = newHeight + 'px';
            if (typeof updateTimeline === 'function') {
                updateTimeline();
            }
        }, { passive: true });
        
        document.addEventListener('touchend', function() {
            if (isResizing) {
                isResizing = false;
                if (typeof updateTimeline === 'function') {
                    updateTimeline();
                }
            }
        });
    });
    </script>
</body>
</html>
